{% macro zmq(cfg_type) %}
{% if cfg_type == 'rpc_config' %}[DEFAULT]{% else %}[oslo_messaging_notifications]{% endif %}
transport_url=zmq://

[oslo_messaging_zmq]
rpc_zmq_host={{network_topology["private"]["address"]}}
use_router_proxy=true
rpc_use_acks=true

{% if zmq.matchmaker == 'redis' %}
[oslo_messaging_zmq]
rpc_zmq_matchmaker=redis

[matchmaker_redis]
password={{ redis.password }}

 {% if redis.deployment == 'single' %}
host={{ address('redis') }}
port={{ redis.ports.server.cont }}
 {% endif %}

 {% if redis.deployment == 'ha' %}
sentinel_hosts={{address('redis-sentinel')}}:{{ redis.ports.sentinel.cont }}
sentinel_group_name={{zmq.sentinel.master_group}}
 {% endif %}

{% endif %}
{% endmacro %}
